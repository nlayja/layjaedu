<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Juego Intuitivo - PC y MÃ³vil</title>
<style>
body {
  margin: 0;
  background: #000;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-family: sans-serif;
  overflow: hidden;
}

#contador {
  margin: 10px;
  font-size: 24px;
  color: white;
}

#juego {
  position: relative;
  width: 100%;
  max-width: 960px;
  aspect-ratio: 8 / 3;
  background: #111;
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  grid-template-rows: repeat(3, 1fr);
  border: 5px solid #333;
}

.celda {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 50px;
  position: relative;
}

.comida-comida {
  transform: scale(2);
  opacity: 0;
  transition: transform 0.4s ease, opacity 0.4s ease;
}

#pacman {
  position: absolute;
  z-index: 10;
  pointer-events: none;
  transition: left 0.1s linear, top 0.1s linear;
}

#barra-progreso {
  width: 100%;
  max-width: 960px;
  height: 20px;
  background: #333;
  border-radius: 15px;
  margin-top: 15px;
  border: 2px solid white;
}

#relleno {
  height: 100%;
  width: 100%;
  background: linear-gradient(to right, #ffcf00, #ffea00);
  border-radius: 12px;
  transition: width 0.3s ease;
}

#cartel-victoria {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 30px;
  border-radius: 30px;
  text-align: center;
  z-index: 100;
  border: 10px solid #FFD700;
  display: none;
  box-shadow: 0 0 50px rgba(255,215,0,0.5);
}
</style>
</head>
<body>

<div id="contador">ğŸª 0  ğŸ‚ 0  ğŸ¬ 0</div>
<div id="juego"></div>
<div id="barra-progreso"><div id="relleno"></div></div>

<div id="cartel-victoria">
  <h1 style="font-size: 60px; margin: 0;">ğŸŒŸ ğŸ† ğŸŒŸ</h1>
  <p style="font-size: 28px; margin: 10px; font-weight: bold; color: #333;">Â¡LO LOGRASTE!</p>
  <p style="font-size: 40px; margin: 0;">ğŸˆ ğŸ¦ ğŸˆ</p>
</div>

<script>
const baseURL = 'https://nlayja.github.io/layjaedu/'; // Cambia si tu GitHub Pages es diferente
const juego = document.getElementById('juego');
const relleno = document.getElementById('relleno');
const contador = document.getElementById('contador');
const cartel = document.getElementById('cartel-victoria');

let pacX = 0;
let pacY = 0;
const filas = 3;
const columnas = 8;

const laberinto = [];
let totalComida = 0;
const tiposComida = ['ğŸª','ğŸ‚','ğŸ¬'];
const conteoComido = {'ğŸª':0,'ğŸ‚':0,'ğŸ¬':0};

function decir(texto) {
  window.speechSynthesis.cancel();
  const mensaje = new SpeechSynthesisUtterance(texto);
  mensaje.lang = 'es-MX';
  window.speechSynthesis.speak(mensaje);
}

// Saludo inicial
window.addEventListener('click', () => {
  decir("Â¡Hola! AyÃºdame a recolectar todos los dulces.");
}, { once: true });

// Crear tablero
for(let y=0; y<filas; y++){
  laberinto[y] = [];
  for(let x=0; x<columnas; x++){
    const celda = document.createElement('div');
    celda.classList.add('celda');
    juego.appendChild(celda);

    if(x === 0 && y === 0){
      laberinto[y][x] = 0;
      celda.innerHTML = '';
    } else {
      const comida = tiposComida[Math.floor(Math.random()*tiposComida.length)];
      celda.innerHTML = comida;
      celda.classList.add('comida');
      laberinto[y][x] = comida;
      totalComida++;
    }
  }
}

function actualizarContador(){
  contador.textContent = `ğŸª ${conteoComido['ğŸª']}   ğŸ‚ ${conteoComido['ğŸ‚']}   ğŸ¬ ${conteoComido['ğŸ¬']}`;
}

// Crear Pacman
const pacman = document.createElement('img');
pacman.src = baseURL + 'perfil40derecha.jpg';
pacman.id = 'pacman';
juego.appendChild(pacman);

pacman.onload = () => {
  const maxSize = 110;
  const ratio = pacman.naturalWidth / pacman.naturalHeight;
  pacman.height = maxSize;
  pacman.width = maxSize * ratio;
  actualizarPacman();
}

function actualizarPacman(){
  const cellWidth = juego.clientWidth / columnas;
  const cellHeight = juego.clientHeight / filas;
  pacman.style.left = (pacX*cellWidth + 5) + 'px';
  pacman.style.top = (pacY*cellHeight + 5) + 'px';
}

function actualizarBarra(){
  const restantes = document.querySelectorAll('.comida').length;
  const porcentaje = (restantes / totalComida) * 100;
  relleno.style.width = porcentaje + '%';

  if(restantes === 0) victoria();
}

function victoria() {
  decir("Â¡Felicidades! Â¡Eres un campeÃ³n!");
  cartel.style.display = 'block';
  setTimeout(() => location.reload(), 6000);
}

// --- Controles teclado ---
window.addEventListener('keydown', e => { moverPacman(e.key); });

// --- Controles tÃ¡ctiles ---
let touchStartX = 0;
let touchStartY = 0;

window.addEventListener('touchstart', e => {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
}, {passive:true});

window.addEventListener('touchend', e => {
  const dx = e.changedTouches[0].clientX - touchStartX;
  const dy = e.changedTouches[0].clientY - touchStartY;

  if(Math.abs(dx) > Math.abs(dy)){
    if(dx > 0) moverPacman('ArrowRight');
    else moverPacman('ArrowLeft');
  } else {
    if(dy > 0) moverPacman('ArrowDown');
    else moverPacman('ArrowUp');
  }
}, {passive:true});

// FunciÃ³n de movimiento
function moverPacman(key){
  let nx = pacX;
  let ny = pacY;
  let direccion = '';

  if(key==='ArrowRight'){ nx++; direccion='right'; }
  if(key==='ArrowLeft'){ nx--; direccion='left'; }
  if(key==='ArrowUp'){ ny--; direccion='up'; }
  if(key==='ArrowDown'){ ny++; direccion='down'; }

  if(nx>=0 && nx<columnas && ny>=0 && ny<filas){
    pacX = nx;
    pacY = ny;

    if(direccion==='right') pacman.src = baseURL + 'perfil40derecha.jpg';
    if(direccion==='left')  pacman.src = baseURL + 'perfil40izquierda.jpg';
    if(direccion==='up')    pacman.src = baseURL + 'perfil40espaldas.jpg';
    if(direccion==='down')  pacman.src = baseURL + 'perfil40agacha.jpg';

    actualizarPacman();

    if(laberinto[ny][nx] !== 0){
      const tipo = laberinto[ny][nx];
      laberinto[ny][nx] = 0;
      const index = ny*columnas + nx;
      const celda = juego.children[index];

      celda.classList.add('comida-comida');
      setTimeout(()=> celda.innerHTML='', 300);
      celda.classList.remove('comida');

      conteoComido[tipo]++;
      actualizarContador();
      actualizarBarra();
    }
  }
}
</script>
</body>
</html>
